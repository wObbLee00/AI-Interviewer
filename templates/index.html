<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Voice Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      padding: 20px;
    }
    button {
      padding: 12px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    #startBtn { background: #4caf50; }
    #stopBtn  { background: #f44336; }
    #messages { margin-top: 20px; }
    .bubble {
      background: #1e1e1e;
      padding: 12px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .user { border-left: 4px solid #4caf50; }
    .bot  { border-left: 4px solid #03a9f4; }
  </style>
</head>
<body>

  <h1>üéôÔ∏è AI Voice Assistant</h1>

  <button id="startBtn">Start Recording</button>
  <button id="stopBtn" disabled>Stop Recording</button>

  <div id="messages"></div>

  <audio id="audioPlayer" controls></audio>

<script>
let mediaRecorder;
let audioChunks = [];
const backendURL = "http://127.0.0.1:8000"; // your FastAPI backend

const startBtn = document.getElementById("startBtn");
const stopBtn  = document.getElementById("stopBtn");
const messages = document.getElementById("messages");
const audioPlayer = document.getElementById("audioPlayer");

startBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);

  mediaRecorder.ondataavailable = (e) => {
    audioChunks.push(e.data);
  };

  mediaRecorder.onstop = async () => {
    const blob = new Blob(audioChunks, { type: "audio/webm" });
    audioChunks = [];
    await sendAudioToBackend(blob);
  };

  mediaRecorder.start();
  startBtn.disabled = true;
  stopBtn.disabled = false;
};

stopBtn.onclick = () => {
  mediaRecorder.stop();
  startBtn.disabled = false;
  stopBtn.disabled = true;
};

async function sendAudioToBackend(blob) {
  const formData = new FormData();
  formData.append("file", blob, "recording.webm");

  const response = await fetch(`${backendURL}/api/talk`, {
    method: "POST",
    body: formData,
  });

  const data = await response.json();

  showMessage("You", data.user_text);
  showMessage("Bot", data.bot_text);

  if (data.audio_url) {
    audioPlayer.src = backendURL + data.audio_url;
    audioPlayer.play();
  }
}

function showMessage(sender, text) {
  const div = document.createElement("div");
  div.className = "bubble " + (sender === "You" ? "user" : "bot");
  div.textContent = `${sender}: ${text}`;
  messages.appendChild(div);
}
</script>

</body>
</html>
